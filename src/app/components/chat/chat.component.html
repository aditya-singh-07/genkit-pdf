<div class="h-screen flex flex-col bg-gradient-to-br from-slate-50 to-slate-200 font-sans">
    <!-- Header -->
    <div class="bg-white/95 backdrop-blur-xl border-b border-white/20 px-6 py-4 flex justify-between items-center shadow-lg relative z-10 flex-shrink-0">
      <div class="flex-1 flex">
        <button 
          (click)="goBack()"
          class="bg-slate-100 hover:bg-slate-200 text-slate-700 border-none px-4 py-3 rounded-xl cursor-pointer flex items-center gap-2 transition-all duration-200 font-medium text-sm hover:-translate-y-0.5">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15,18 9,12 15,6"/>
          </svg>
          <span class="hidden sm:inline">Back</span>
        </button>
      </div>
      
      <div class="flex-2 text-center">
        <h2 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent m-0 mb-1">
          AI Chat Assistant
        </h2>
        <p *ngIf="sessionInfo" class="text-slate-500 text-sm m-0 flex items-center justify-center gap-2">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
          </svg>
          {{ sessionInfo.filename }} â€¢ {{ sessionInfo.textLength.toLocaleString() }} chars
        </p>
      </div>
      
      <div class="flex-1 flex justify-end">
        <button 
          (click)="clearConversation()"
          class="bg-slate-100 hover:bg-slate-200 text-slate-700 border-none px-4 py-3 rounded-xl cursor-pointer flex items-center gap-2 transition-all duration-200 font-medium text-sm hover:-translate-y-0.5">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          </svg>
          <span class="hidden sm:inline">Clear</span>
        </button>
      </div>
    </div>
  
    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex-1 flex flex-col items-center justify-center text-slate-500">
      <div class="w-10 h-10 border-3 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"></div>
      <p>Loading conversation...</p>
    </div>
  
    <!-- Chat Main -->
    <div *ngIf="!isLoading" class="flex-1 flex flex-col overflow-hidden relative">
      <div class="flex-1 px-6 py-4 overflow-y-auto flex flex-col gap-4 scroll-smooth custom-scrollbar" #messagesContainer>
        <!-- Welcome Message -->
        <div *ngIf="messages.length === 0" class="text-center py-8 px-4 text-slate-500 m-auto">
          <div class="mb-4 opacity-60">
            <svg class="w-12 h-12 mx-auto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
          </div>
          <h3 class="text-slate-700 font-semibold m-0 mb-2">Start Your Conversation</h3>
          <p class="text-sm m-0">Ask me anything about your PDF document. I'm here to help!</p>
        </div>
  
        <!-- Messages -->
        <div *ngFor="let message of messages; trackBy: trackByMessage" 
             class="flex gap-4 max-w-[85%] animate-message-slide"
             [class.self-end]="message.role === 'user'"
             [class.flex-row-reverse]="message.role === 'user'"
             [class.self-start]="message.role === 'assistant'">
          
          <div class="flex-shrink-0 w-10 h-10">
            <div *ngIf="message.role === 'user'" 
                 class="w-full h-full rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-semibold">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
            </div>
            <div *ngIf="message.role === 'assistant'" 
                 class="w-full h-full rounded-full bg-gradient-to-br from-pink-400 to-red-500 flex items-center justify-center text-white font-semibold">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"/>
                <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"/>
                <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"/>
                <path d="M12 3c0 1-1 2-2 2s-2 1-2 2 1 1 2 2 2 1 2 2 1-1 2-2 2-1 2-2-1-1-2-2-2-1-2-2z"/>
              </svg>
            </div>
          </div>
          
          <div class="bg-white px-5 py-4 rounded-2xl relative shadow-lg border border-white/20"
               [class.bg-gradient-to-r]="message.role === 'user'"
               [class.from-blue-600]="message.role === 'user'"
               [class.to-purple-600]="message.role === 'user'"
               [class.text-white]="message.role === 'user'">
            <div class="leading-relaxed break-words text-sm" [innerHTML]="formatMessage(message.content)"></div>
            <div class="text-xs opacity-70 mt-2">{{ message.timestamp | date:'shortTime' }}</div>
          </div>
        </div>
        
        <!-- Typing Indicator -->
        <div *ngIf="isTyping" class="flex gap-4 max-w-[85%] self-start animate-message-slide">
          <div class="flex-shrink-0 w-10 h-10">
            <div class="w-full h-full rounded-full bg-gradient-to-br from-pink-400 to-red-500 flex items-center justify-center text-white font-semibold">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"/>
                <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"/>
                <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"/>
                <path d="M12 3c0 1-1 2-2 2s-2 1-2 2 1 1 2 2 2 1 2 2 1-1 2-2 2-1 2-2-1-1-2-2-2-1-2-2z"/>
              </svg>
            </div>
          </div>
          <div class="bg-white px-5 py-4 rounded-2xl relative shadow-lg border border-white/20">
            <div class="flex gap-1 items-center mb-1">
              <span class="w-2 h-2 rounded-full bg-slate-400 animate-typing"></span>
              <span class="w-2 h-2 rounded-full bg-slate-400 animate-typing" style="animation-delay: -0.16s"></span>
              <span class="w-2 h-2 rounded-full bg-slate-400 animate-typing" style="animation-delay: -0.32s"></span>
            </div>
            <div class="text-sm text-slate-500 italic">AI is thinking...</div>
          </div>
        </div>
      </div>
  
      <!-- Chat Input -->
      <div class="px-6 py-4 bg-white/80 backdrop-blur-xl border-t border-white/20 flex-shrink-0">
        <div class="max-w-4xl mx-auto">
          <div class="flex gap-3 items-end bg-white rounded-3xl p-3 shadow-lg border border-black/10">
            <textarea 
              [(ngModel)]="currentMessage"
              name="message"
              placeholder="Ask me anything about your PDF..."
              rows="1"
              #messageInput
              (keydown)="onKeyDown($event)"
              (input)="adjustTextareaHeight()"
              [disabled]="isTyping"
              class="flex-1 border-none outline-none resize-none font-inherit text-sm leading-relaxed max-h-20 min-h-5 bg-transparent text-slate-700 placeholder-slate-400 disabled:opacity-60 disabled:cursor-not-allowed overflow-y-auto"></textarea>
            
            <button 
              type="button"
              (click)="sendMessage()"
              [disabled]="!currentMessage.trim() || isTyping"
              class="bg-gradient-to-r from-blue-600 to-purple-600 text-white border-none w-11 h-11 rounded-full flex items-center justify-center cursor-pointer transition-all duration-200 flex-shrink-0 hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
              <div *ngIf="isTyping" class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
              <svg *ngIf="!isTyping" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"/>
                <polygon points="22,2 15,22 11,13 2,9 22,2"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>